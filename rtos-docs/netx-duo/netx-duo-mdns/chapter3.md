---
title: Bölüm 3-iç hizmet önbelleğinin açıklaması
description: 'NetX Duo mDNS modülü iki iç hizmet önbelleğini yönetir: yerel hizmet önbelleği ve eş hizmet önbelleği.'
author: philmea
ms.author: philmea
ms.date: 07/09/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 007f1080a076730cfbcdedc9f063ac0c427a414c
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/22/2021
ms.locfileid: "104825913"
---
# <a name="chapter-3---description-of-internal-service-cache"></a><span data-ttu-id="f3477-103">Bölüm 3-iç hizmet önbelleğinin açıklaması</span><span class="sxs-lookup"><span data-stu-id="f3477-103">Chapter 3 - Description of internal service cache</span></span>

<span data-ttu-id="f3477-104">NetX Duo mDNS modülü iki iç hizmet önbelleğini yönetir: yerel hizmet önbelleği ve eş hizmet önbelleği.</span><span class="sxs-lookup"><span data-stu-id="f3477-104">NetX Duo mDNS module manages two internal services caches: the local service cache, and the peer service cache.</span></span> <span data-ttu-id="f3477-105">Yerel hizmet önbelleği, düğümde çalışan uygulamalar tarafından sunulan hizmetlerle ilgili kaynak kayıtlarını depolar.</span><span class="sxs-lookup"><span data-stu-id="f3477-105">The local service cache stores Resource Records related to services offered by applications running on the node.</span></span> <span data-ttu-id="f3477-106">Gelen sorgular için, söz konusu hizmet sunulan hizmetle eşleşiyorsa, yerel hizmet önbelleğinde depolanan yanıtları içeren mDNS yanıtları.</span><span class="sxs-lookup"><span data-stu-id="f3477-106">For incoming queries, if the question matches the service offered, mDNS responses with answers stored in the local service cache.</span></span> <span data-ttu-id="f3477-107">Uygulamalar, API *nx_mdns_service_add ()* çağırarak Hizmetleri kaydeder.</span><span class="sxs-lookup"><span data-stu-id="f3477-107">Applications register services by calling the API *nx_mdns_service_add()*.</span></span> <span data-ttu-id="f3477-108">Hizmetleri kaldırmak için uygulamalar, yerel hizmet önbelleğindeki karşılık gelen girdileri kaldırmadan önce "güle" iletileri gönderecek olan API *nx_mdns_service_delete ()* kullanır.</span><span class="sxs-lookup"><span data-stu-id="f3477-108">To remove services, applications use the API *nx_mdns_service_delete()*, which will in turn send "goodbye" messages before removing the corresponding entries in the local service cache.</span></span>

<span data-ttu-id="f3477-109">Bir hizmet eklendiğinde, mDNS yerel hizmet önbelleğinde en az 3 kaynak kaydı tutar: SRV, PTR ve TXT.</span><span class="sxs-lookup"><span data-stu-id="f3477-109">When a service is added, mDNS maintains at least 3 Resource Records in the local service cache: SRV, PTR, and TXT.</span></span> <span data-ttu-id="f3477-110">Hizmet türü alt tür içeriyorsa ek PTR kaynak kaydı eklenebilir.</span><span class="sxs-lookup"><span data-stu-id="f3477-110">Additional PTR Resource Record may be added if the service type includes subtype.</span></span> <span data-ttu-id="f3477-111">Örneğin, bir uygulama bir hizmeti kaydeder:</span><span class="sxs-lookup"><span data-stu-id="f3477-111">For example, an application registers a service:</span></span>

```
*name*._*subtype*._sub._*type*._tcp.local,
```

<span data-ttu-id="f3477-112">için bir tane olmak üzere yerel hizmet önbelleğine iki PTR kaynak kaydı eklenir</span><span class="sxs-lookup"><span data-stu-id="f3477-112">two PTR Resource Records are added to the local service cache, one for</span></span>

```
“*_subtype._*sub*._type._*tcp.local *PTR name.type._*tcp*.*local”
```

<span data-ttu-id="f3477-113">ve diğeri</span><span class="sxs-lookup"><span data-stu-id="f3477-113">and the other one for</span></span>

```
*“_type._*tcp*.*local *PTR name.type._*tcp*.*local”.
```

<span data-ttu-id="f3477-114">Eş hizmeti önbelleği, komşu düğümlerden alınan mDNS kaynak kayıtlarını içerir.</span><span class="sxs-lookup"><span data-stu-id="f3477-114">The peer service cache contains mDNS Resource Records received from neighboring nodes.</span></span> <span data-ttu-id="f3477-115">mDNS modülü, ağdaki diğer düğümlerin tanıtıldığı kaynak kayıtlarını toplar ve alınan bilgileri eş hizmeti önbelleğinde depolar.</span><span class="sxs-lookup"><span data-stu-id="f3477-115">mDNS module collects Resource Records advertised by other nodes on the network, and stores the received information in the peer service cache.</span></span> <span data-ttu-id="f3477-116">Uygulama, ana bilgisayar IPv4 veya IPv6 adresleri gibi bilgiler için sorguladığında, mDNS yerel olarak önbelleğe alınan yanıtlar için eş hizmeti önbelleğinde arama yapar.</span><span class="sxs-lookup"><span data-stu-id="f3477-116">When application queries for information such as host IPv4 or IPv6 addresses, mDNS searches the peer service cache for locally cached responses.</span></span> <span data-ttu-id="f3477-117">Uygulamalar, eşler tarafından sunulan hizmetler için sorguladığında, mDNS ilgili PTR, SRV, TXT ve IPv4/IPv6 adres kayıtları için önbelleği arar.</span><span class="sxs-lookup"><span data-stu-id="f3477-117">When application queries for services offered by peers, mDNS searches through the cache for related PTR, SRV, TXT, and IPv4/IPv6 address records.</span></span> <span data-ttu-id="f3477-118">Eş hizmeti önbelleği, düğüme gönderilen sorguları da depolar.</span><span class="sxs-lookup"><span data-stu-id="f3477-118">The peer service cache also stores queries sent to the node.</span></span> <span data-ttu-id="f3477-119">Örneğin, bir uygulama nx_mdns_service_one_shot_query çağırarak belirli bir hizmet talep edebilir *.*</span><span class="sxs-lookup"><span data-stu-id="f3477-119">For example, an application may request a particular service by calling *nx_mdns_service_one_shot_query.*</span></span> <span data-ttu-id="f3477-120">Hizmet eş hizmeti önbelleğinde bulunamazsa, mDNS, eş hizmeti önbelleğinde sorgu soruları (PTR, SRV ve TXT) oluşturur.</span><span class="sxs-lookup"><span data-stu-id="f3477-120">If the service is not found in the peer service cache, mDNS creates query questions (PTR, SRV, and TXT) in the peer service cache.</span></span> <span data-ttu-id="f3477-121">Bu sorgu soruları, hizmet çözümlenene veya zaman aşımına uğrayana düzenli olarak ağa gönderilir. Benzer şekilde, uygulama, uzun bir süre boyunca belirli bir hizmeti istemek için API *nx_mdns_service_continous_query ()* kullanabilir (uygulama, API *nx_mdns_service_query_stop ()* ) kullanarak daha önce verilen bir sürekli sorguyu iptal eder.</span><span class="sxs-lookup"><span data-stu-id="f3477-121">These query questions will be sent to the network periodically till the service is resolved, or times out. Similar, the application may use the API *nx_mdns_service_continous_query()* to request a particular service over a long period of time (application cancels a previously issued continuous query by using the API *nx_mdns_service_query_stop()* ).</span></span> <span data-ttu-id="f3477-122">Ağa sorgu göndermeden, eş hizmeti önbelleğinde belirli bir hizmeti aramak için, uygulamalar API *nx_mdns_serivce_lookup () kullanabilir.*</span><span class="sxs-lookup"><span data-stu-id="f3477-122">To search for a particular service in the peer service cache without sending queries to the network, applications can use the API *nx_mdns_serivce_lookup().*</span></span> <span data-ttu-id="f3477-123">Bu API yalnızca eş hizmet önbelleğindeki kaynak kayıtlarını arar.</span><span class="sxs-lookup"><span data-stu-id="f3477-123">This API only searches the resource records in the peer service cache.</span></span>

<span data-ttu-id="f3477-124">Her kaynak kaydı, hizmet önbelleklerindeki *NX_MDNS_RR* bir veri yapısında depolanır.</span><span class="sxs-lookup"><span data-stu-id="f3477-124">Each Resource Record is stored in a data structure *NX_MDNS_RR* in the service caches.</span></span> <span data-ttu-id="f3477-125">Kaynak kayıtlarındaki dizeler değişken uzunluktadır, bu nedenle *NX_MDNS_RR* yapısında depolanmaz.</span><span class="sxs-lookup"><span data-stu-id="f3477-125">Strings in Resource Records are variable length, therefore are not stored in the *NX_MDNS_RR* structure.</span></span> <span data-ttu-id="f3477-126">Kaynak kaydı, dizenin depolandığı gerçek bellek konumuna yönelik bir işaretçi içerir.</span><span class="sxs-lookup"><span data-stu-id="f3477-126">The Resource Record contains a pointer to the actual memory location where the string is stored.</span></span> <span data-ttu-id="f3477-127">Dize tablosu ve kaynak kayıtları, hizmet önbelleğini paylaşır.</span><span class="sxs-lookup"><span data-stu-id="f3477-127">The string table and the Resource Records share the service cache.</span></span> <span data-ttu-id="f3477-128">Kaynak kayıtları, hizmet önbelleğinin başından itibaren depolanır ve önbelleğin sonuna doğru artar.</span><span class="sxs-lookup"><span data-stu-id="f3477-128">Resource Records are stored from the beginning of the service cache, and grow towards the end of the cache.</span></span> <span data-ttu-id="f3477-129">Dize tablosu, hizmet önbelleğinin sonundan başlar ve önbelleğin başına doğru büyür.</span><span class="sxs-lookup"><span data-stu-id="f3477-129">The string table starts from the end of the service cache and grows towards the beginning of the cache.</span></span> <span data-ttu-id="f3477-130">Dize tablosundaki her bir dizenin bir uzunluk alanı ve bir sayaç alanı vardır.</span><span class="sxs-lookup"><span data-stu-id="f3477-130">Each string in the string table has a length field and a counter field.</span></span> <span data-ttu-id="f3477-131">Dize tablosuna bir dize eklendiğinde, tabloda aynı dize zaten varsa, sayaç değeri artırılır ve dize için bellek ayrılmaz.</span><span class="sxs-lookup"><span data-stu-id="f3477-131">When a string is added to the string table, if the same string is already present in the table, the counter value is incremented and no memory is allocated for the string.</span></span> <span data-ttu-id="f3477-132">Hizmet önbelleğine daha fazla kaynak kaydı veya yeni dize eklenebileceği takdirde hizmet önbelleği tam olarak değerlendirilir.</span><span class="sxs-lookup"><span data-stu-id="f3477-132">The service cache is considered full if no more resource records or new strings can be added to the service cache.</span></span>

<span data-ttu-id="f3477-133">Bir uygulamanın yerel ağda sunulan hizmetleri bulmanın iki yolu vardır.</span><span class="sxs-lookup"><span data-stu-id="f3477-133">There are two ways for an application to find services offered on the local network.</span></span> <span data-ttu-id="f3477-134">Belirli bir hizmeti tek kararlı bir sorgu aracılığıyla arayabilir ya da ağdaki etkinlikleri "izlemek" üzere sürekli bir sorgu başlatabilir.</span><span class="sxs-lookup"><span data-stu-id="f3477-134">It can either issue a specific service look up through a one-shot query, or it can initiate a continuous query to “monitor” the activities on the network.</span></span> <span data-ttu-id="f3477-135">Tek kısa sorgu senaryosunda, uygulamanın hizmet türünü belirtmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="f3477-135">In the one-short query scenario, the application must specify the service type.</span></span> <span data-ttu-id="f3477-136">mDNS yerel hizmet önbelleğinde ve eş hizmeti önbelleğinde arama yapar.</span><span class="sxs-lookup"><span data-stu-id="f3477-136">mDNS searches through the local service cache and the peer service cache.</span></span> <span data-ttu-id="f3477-137">Bir hizmet örneği bulunursa, tek çizgili sorgu kaynak kayıtlarında bulunan bilgilerle birlikte döndürülür.</span><span class="sxs-lookup"><span data-stu-id="f3477-137">If a service instances is located, the one-shot query returns with the information found in the Resource Records.</span></span> <span data-ttu-id="f3477-138">Yerel hizmet önbelleğinde veya eş hizmeti önbelleğinde bir kayıt yoksa, mDNS sorgu iletilerini gönderir.</span><span class="sxs-lookup"><span data-stu-id="f3477-138">If there are no records in the local service cache or peer service cache, mDNS sends out query messages.</span></span> <span data-ttu-id="f3477-139">Örnek adı belirtilmişse, "ad. Type. Local" biçiminde belirli bir örnek adına sahip *herhangi* bir tür (SRV ve txt türü sorgula) yerel ağa gönderilir.</span><span class="sxs-lookup"><span data-stu-id="f3477-139">If the instance name is specified, an *ANY* type (query the SRV and TXT type) with the specific instance name, in the form of “name.type.local”, is sent to the local network.</span></span> <span data-ttu-id="f3477-140">Örnek adı belirtilmemişse, yerel ağa bir PTR türü sorgu gönderilir.</span><span class="sxs-lookup"><span data-stu-id="f3477-140">If the instance name is not specified, a PTR type of query is sent to the local network.</span></span> <span data-ttu-id="f3477-141">Alınan ilk tamamlanmış hizmet çağırana döndürülür.</span><span class="sxs-lookup"><span data-stu-id="f3477-141">The first complete service received is returned to the caller.</span></span>

<span data-ttu-id="f3477-142">Sürekli sorgu farklı şekilde çalışır.</span><span class="sxs-lookup"><span data-stu-id="f3477-142">Continuous query works differently.</span></span> <span data-ttu-id="f3477-143">Sürekli bir sorgu için tipik kullanım örneği, belirli bir hizmet için yerel ağı (örneğin, yerel ağdaki yazdırma hizmetlerini sürekli olarak aramak için) izbilmenizdir.</span><span class="sxs-lookup"><span data-stu-id="f3477-143">The typical use case for a continuous query is to monitor the local network for a specific service (for example to constantly look for printing services on the local network).</span></span> <span data-ttu-id="f3477-144">Bu durumda, uygulama belirli türde hizmetler için bir arama sorgusu (API *nx_mdns_service_continious_* sorgusu aracılığıyla) yayınlar.</span><span class="sxs-lookup"><span data-stu-id="f3477-144">In this case the application issues a search query (via the API *nx_mdns_service_continious_* query) for certain type of services.</span></span> <span data-ttu-id="f3477-145">Çağıran, genellikle belirli bir yanıt beklemez.</span><span class="sxs-lookup"><span data-stu-id="f3477-145">The caller typically does not wait for a particular response.</span></span> <span data-ttu-id="f3477-146">Sürekli sorgu olarak gönderilen sorgular için, mDNS modülü sorguları, üstel olarak artan aralıklar ile düzenli aralıklarla iletir.</span><span class="sxs-lookup"><span data-stu-id="f3477-146">For queries submitted as continuous query, the mDNS module transmits the queries periodically with exponentially increasing intervals.</span></span> <span data-ttu-id="f3477-147">Sorguyu durdurmak için, uygulamanın bu sorgularda iç zamanlayıcıyı durdurmak üzere API *nx_mdns_service_query_stop* kullanması gerekir.</span><span class="sxs-lookup"><span data-stu-id="f3477-147">To stop the query, application must use the API *nx_mdns_service_query_stop* to stop the internal timer in these queries.</span></span> <span data-ttu-id="f3477-148">Sorgu türü NULL olabilir, bu durumda sorgu türü özel PTR türü "_services. _DNS-SD. _udp. Local" olarak ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="f3477-148">The query type can be NULL, in which case the query type is set to special PTR type “_services._dns-sd._udp.local”.</span></span> <span data-ttu-id="f3477-149">Bu hizmet türü, mDNS tarafından yerel ağda bulunan tüm hizmetleri keşfetmenin bir yolu olarak tanımlanır.</span><span class="sxs-lookup"><span data-stu-id="f3477-149">This service type is defined by mDNS as a way to discover all services available on the local network.</span></span> <span data-ttu-id="f3477-150">Örnek adı belirtilmişse, yerel ağa "Name. Type. Local" adlı belirli örnek adına sahip HERHANGI bir tür (SRV ve TXT türü sorgula) gönderilir.</span><span class="sxs-lookup"><span data-stu-id="f3477-150">If the instance name is supplied, an ANY type (query the SRV and TXT type) with the specific instance name “name.type.local” is sent to the local network.</span></span> <span data-ttu-id="f3477-151">Örnek adı NULL ise, yerel ağa bir PTR türü sorgu gönderilir.</span><span class="sxs-lookup"><span data-stu-id="f3477-151">If the instance name is NULL, a PTR type of query is sent to the local network,</span></span>

<span data-ttu-id="f3477-152">İstenmeyen sorgulardan gelen yanıtlar da dahil olmak üzere tüm yanıtlar, eşdüzey hizmet önbelleğine kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="f3477-152">All responses, including responses from unsolicited queries, are recorded in the peer service cache.</span></span> <span data-ttu-id="f3477-153">Daha sonra uygulama, eş hizmet önbelleğinden belirli bir hizmeti almak için API *nx_mdns_service_lookup* kullanır.</span><span class="sxs-lookup"><span data-stu-id="f3477-153">At a later time, the application uses the API *nx_mdns_service_lookup* to retrieve specific service from the peer service cache.</span></span>

<span data-ttu-id="f3477-154">Parçalanmaya yönelik özel Not: her *NX_MDNS_RR* yapısı boyut olarak sabitlenmiştir ve bu nedenle MDNs RR 'leri ekleyip sildiğinden parçalanmaya tabi değildir.</span><span class="sxs-lookup"><span data-stu-id="f3477-154">Special note on fragmentation: Each *NX_MDNS_RR* structure is fixed in size, and therefore is not subject to fragmentation as mDNS adds and deletes RRs.</span></span> <span data-ttu-id="f3477-155">Ancak dizeler değişken uzunluktadır.</span><span class="sxs-lookup"><span data-stu-id="f3477-155">However strings are variable length.</span></span> <span data-ttu-id="f3477-156">Bir dize silindikten sonra, alan kullanılabilir hale gelir ve yeni dize sığmayacak kadar yeni bir dize için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="f3477-156">After a string is deleted, the space becomes available and could be used for a new string if the new string is able to fit in.</span></span> <span data-ttu-id="f3477-157">Ancak bu işlem belleğin parçaya neden olur.</span><span class="sxs-lookup"><span data-stu-id="f3477-157">But this operation causes the memory to fragment.</span></span> <span data-ttu-id="f3477-158">Hizmetler eklenip kaldırıldıkça, dize tablosu, hizmet önbelleğinde dize için yeterli kullanılmamış bayt içermese de, yeni dizelerin eklenemeyeceği noktaya parçalanabilir.</span><span class="sxs-lookup"><span data-stu-id="f3477-158">As services are added and removed, the string table may be fragmented to the point that no new strings can be added even though the service cache contains enough unused bytes for the string.</span></span> <span data-ttu-id="f3477-159">Yerel uygulamalar daha kararlı ve öngörülebilir olmaya eğilimlidir.</span><span class="sxs-lookup"><span data-stu-id="f3477-159">Local applications tend to be more stable and predictable.</span></span> <span data-ttu-id="f3477-160">Bu nedenle, yerel hizmet önbelleği parçalanmayı daha az olabilir.</span><span class="sxs-lookup"><span data-stu-id="f3477-160">Therefore the local service cache is less likely to suffer from fragmentation.</span></span> <span data-ttu-id="f3477-161">Eş hizmet önbelleği, diğer taraftan, hizmetler kullanılabilir hale geldiğinde sürekli olarak RR 'Ler ekleyin veya hizmetler ağdaki düğümler tarafından siliniyorsa RR 'Leri kaldırın.</span><span class="sxs-lookup"><span data-stu-id="f3477-161">The peer service cache, on the other hand, constantly add RRs as the services become available, or remove RRs as services are deleted by the nodes on the network.</span></span> <span data-ttu-id="f3477-162">Ağ üzerindeki hizmetler, dize tablosunda daha sık ayırma/silme işlemlerine neden olur ve gider.</span><span class="sxs-lookup"><span data-stu-id="f3477-162">Services on the network come and go, causing more frequent allocate/delete operations on the string table.</span></span> <span data-ttu-id="f3477-163">Zaman içinde, dize tablosunun parçalanmış hale gelmesi olasıdır.</span><span class="sxs-lookup"><span data-stu-id="f3477-163">Over time it is possible the string table becomes fragmented.</span></span> <span data-ttu-id="f3477-164">Bu durum gerçekleştiğinde, bir basit çözüm tüm eşdüzey hizmet önbelleğinin temizlenmesi olur.</span><span class="sxs-lookup"><span data-stu-id="f3477-164">When this situation happens, a simple solution is to flush the entire peer service cache.</span></span> <span data-ttu-id="f3477-165">Bu, API *nx_mdns_peer_cache_clear ()* çağırarak yapılabilir.</span><span class="sxs-lookup"><span data-stu-id="f3477-165">This can be done by calling the API *nx_mdns_peer_cache_clear().*</span></span> <span data-ttu-id="f3477-166">Bu API 'nin bekleyen sürekli sorguları otomatik olarak sonlandırdığına unutmayın.</span><span class="sxs-lookup"><span data-stu-id="f3477-166">Note that this API automatically terminates any outstanding continuous queries.</span></span>
